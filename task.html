<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks</title>
    <link rel="stylesheet" href="task.css">
    <link rel="stylesheet" href="tap.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
</head>
<body>
    <div class="main-container">
        <div class="task-container">
            <div class="task-header">
                <img src="star.png" alt="Star Logo" class="star-logo">
                <h2>See the tasks available</h2>
                <p>Weâ€™ll reward you immediately with points after each task completion.</p>
            </div>

            <!-- Slider tasks (permanently disabled after claiming) -->
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="task-item" onclick="handleTaskClick('https://t.me/star_coin_master', this, 100, 'task1', true)">
                            <div class="task-info">
                                <img src="telegram.png" alt="Telegram Logo" class="task-icon">
                                <div class="task-description">
                                    <p>Join Star Community</p>
                                    <span>+ 100 str</span>
                                </div>
                            </div>
                            <button class="claim-button" style="display: none;" onclick="claimPoints(event, this, 'task1', true)">Claim</button>
                        </div>
                    </div>

                    <div class="swiper-slide">
                        <div class="task-item" onclick="handleTaskClick('https://t.me/star_coin_master1', this, 100, 'task2', true)">
                            <div class="task-info">
                                <img src="telegram.png" alt="Telegram Logo" class="task-icon">
                                <div class="task-description">
                                    <p>Join Star Coin News</p>
                                    <span>+ 100 str</span>
                                </div>
                            </div>
                            <button class="claim-button" style="display: none;" onclick="claimPoints(event, this, 'task2', true)">Claim</button>
                        </div>
                    </div>
                </div>
                <!-- Add Pagination if needed -->
                <div class="swiper-pagination"></div>
            </div>

            <!-- Non-slider tasks (can be clicked again after 5 minutes) -->
            <div class="non-slider-tasks">
                <div class="non-slider-task" onclick="handleTaskClick('https://t.me/blum/app?startapp=ref_8vhUHveoeQ', this, 100, 'task3', false)">
                    <div class="task-info">
                        <img src="blum.png" alt="Blum Logo" class="task-icon">
                        <div class="task-description">
                            <p>Play Blum</p>
                            <span>+ 100 str</span>
                        </div>
                    </div>
                    <button class="claim-button" style="display: none;" onclick="claimPoints(event, this, 'task3', false)">Claim</button>
                </div>

                <div class="non-slider-task" onclick="handleTaskClick('https://t.me/star_coin_master_bot', this, 100, 'task4', false)">
                    <div class="task-info">
                        <img src="friend.png" alt="Friend Logo" class="task-icon">
                        <div class="task-description">
                            <p>Invite a friend to Star</p>
                            <span>+ 100 str</span>
                        </div>
                    </div>
                    <button class="claim-button" style="display: none;" onclick="claimPoints(event, this, 'task4', false)">Claim</button>
                </div>

                <div class="non-slider-task" onclick="handleTaskClick('https://t.me/major/start?startapp=6850021970', this, 100, 'task5', false)">
                    <div class="task-info">
                        <img src="major.png" alt="Major Logo" class="task-icon">
                        <div class="task-description">
                            <p>Play Major</p>
                            <span>+ 100 str</span>
                        </div>
                    </div>
                    <button class="claim-button" style="display: none;" onclick="claimPoints(event, this, 'task5', false)">Claim</button>
                </div>
            </div>
        </div>

        <div class="menu-container">
            <div class="round-box"></div>
            <div class="menu">
                <a href="index.html"><img src="tap.png" alt="Tap" class="menu-icon"></a>
                <a href="friend.html"><img src="friend.png" alt="Friend" class="menu-icon"></a>
                <a href="task.html"><img src="task.png" alt="Task" class="menu-icon"></a>
                <a href="withdraw.html"><img src="withdraw.png" alt="Withdraw" class="menu-icon"></a>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize Swiper after the DOM is loaded
            var swiper = new Swiper('.swiper-container', {
                direction: 'horizontal',
                loop: true,
                slidesPerView: 1,
                spaceBetween: 30,
                autoplay: {
                    delay: 3000,
                    disableOnInteraction: false,
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
            });

            // Check for claimed tasks and update buttons
            const claimButtons = document.querySelectorAll('.claim-button');
            claimButtons.forEach(button => {
                const taskId = button.parentElement.onclick.toString().match(/'([^']+)'/)[1]; // Extract taskId
                const lastClaimTime = localStorage.getItem(`lastClaimTime_${taskId}`);
                const currentTime = new Date().getTime();

                // Check if the task is a slider task
                const isSliderTask = taskId === 'task1' || taskId === 'task2';
                const claimedTasks = JSON.parse(localStorage.getItem('claimedTasks')) || {};

                if (isSliderTask && claimedTasks[taskId]) {
                    // If slider task is claimed, disable the button
                    button.textContent = "Claimed";
                    button.style.backgroundColor = "gray";
                    button.style.pointerEvents = "none";
                } else if (!isSliderTask && lastClaimTime && currentTime - lastClaimTime < 300000) {
                    // If it's a non-slider task and hasn't been 5 minutes
                    button.textContent = "Claimed";
                    button.style.backgroundColor = "gray";
                    button.style.pointerEvents = "none";
                } else {
                    button.style.display = "inline-block"; // Show button if conditions are met
                }
            });
        });

        function handleTaskClick(url, taskElement, points, taskId, isSliderTask) {
            // Open the URL in a new tab
            window.open(url, '_blank');

            // Check if it's a slider task (permanently disabled after one claim)
            const claimedTasks = JSON.parse(localStorage.getItem('claimedTasks')) || {};
            if (isSliderTask && claimedTasks[taskId]) return; // If already claimed, exit

            // Show the claim button
            const claimButton = taskElement.querySelector('.claim-button');
            claimButton.style.display = 'inline-block';
        }

        function claimPoints(event, button, taskId, isSliderTask) {
            event.stopPropagation(); // Prevent default action

            // Check if the task has already been claimed for slider tasks (permanent claim)
            const claimedTasks = JSON.parse(localStorage.getItem('claimedTasks')) || {};
            if (claimedTasks[taskId]) return;

            // For non-slider tasks, check if 5 minutes have passed since the last claim
            if (!isSliderTask) {
                const lastClaimTime = localStorage.getItem(`lastClaimTime_${taskId}`);
                const currentTime = new Date().getTime();

                if (lastClaimTime && currentTime - lastClaimTime < 300000) {
                    // If 5 minutes haven't passed, do nothing
                    return;
                }
                localStorage.setItem(`lastClaimTime_${taskId}`, currentTime); // Update claim time
            }

            // Update user's points in localStorage
            let userPoints = parseInt(localStorage.getItem('userPoints')) || 0;
            userPoints += points; // Each claim adds points (slider or non-slider)
            localStorage.setItem('userPoints', userPoints);

            // Update claimed task status
            claimedTasks[taskId] = true;
            localStorage.setItem('claimedTasks', JSON.stringify(claimedTasks));

            // Update button state to "Claimed"
            button.textContent = "Claimed";
            button.style.backgroundColor = "gray";
            button.style.pointerEvents = "none";
        }
    </script>
</body>
</html>
